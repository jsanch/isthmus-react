!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AsBridge=t():e.AsBridge=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){(function(r){var n;t=e.exports=Z,n="object"==typeof r&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var i=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],s=t.src=[],u=0,l=u++;s[l]="0|[1-9]\\d*";var c=u++;s[c]="[0-9]+";var p=u++;s[p]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var h=u++;s[h]="("+s[l]+")\\.("+s[l]+")\\.("+s[l]+")";var f=u++;s[f]="("+s[c]+")\\.("+s[c]+")\\.("+s[c]+")";var m=u++;s[m]="(?:"+s[l]+"|"+s[p]+")";var v=u++;s[v]="(?:"+s[c]+"|"+s[p]+")";var _=u++;s[_]="(?:-("+s[m]+"(?:\\."+s[m]+")*))";var d=u++;s[d]="(?:-?("+s[v]+"(?:\\."+s[v]+")*))";var g=u++;s[g]="[0-9A-Za-z-]+";var y=u++;s[y]="(?:\\+("+s[g]+"(?:\\."+s[g]+")*))";var b=u++,w="v?"+s[h]+s[_]+"?"+s[y]+"?";s[b]="^"+w+"$";var x="[v=\\s]*"+s[f]+s[d]+"?"+s[y]+"?",L=u++;s[L]="^"+x+"$";var j=u++;s[j]="((?:<|>)?=?)";var O=u++;s[O]=s[c]+"|x|X|\\*";var E=u++;s[E]=s[l]+"|x|X|\\*";var T=u++;s[T]="[v=\\s]*("+s[E]+")(?:\\.("+s[E]+")(?:\\.("+s[E]+")(?:"+s[_]+")?"+s[y]+"?)?)?";var k=u++;s[k]="[v=\\s]*("+s[O]+")(?:\\.("+s[O]+")(?:\\.("+s[O]+")(?:"+s[d]+")?"+s[y]+"?)?)?";var P=u++;s[P]="^"+s[j]+"\\s*"+s[T]+"$";var S=u++;s[S]="^"+s[j]+"\\s*"+s[k]+"$";var C=u++;s[C]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var H=u++;s[H]="(?:~>?)";var z=u++;s[z]="(\\s*)"+s[H]+"\\s+",a[z]=new RegExp(s[z],"g");var D=u++;s[D]="^"+s[H]+s[T]+"$";var R=u++;s[R]="^"+s[H]+s[k]+"$";var $=u++;s[$]="(?:\\^)";var V=u++;s[V]="(\\s*)"+s[$]+"\\s+",a[V]=new RegExp(s[V],"g");var A=u++;s[A]="^"+s[$]+s[T]+"$";var F=u++;s[F]="^"+s[$]+s[k]+"$";var M=u++;s[M]="^"+s[j]+"\\s*("+x+")$|^$";var I=u++;s[I]="^"+s[j]+"\\s*("+w+")$|^$";var N=u++;s[N]="(\\s*)"+s[j]+"\\s*("+x+"|"+s[T]+")",a[N]=new RegExp(s[N],"g");var B=u++;s[B]="^\\s*("+s[T]+")\\s+-\\s+("+s[T]+")\\s*$";var q=u++;s[q]="^\\s*("+s[k]+")\\s+-\\s+("+s[k]+")\\s*$";var U=u++;s[U]="(<|>)?=?\\s*\\*";for(var X=0;X<35;X++)n(X,s[X]),a[X]||(a[X]=new RegExp(s[X]));function G(e,t){if(e instanceof Z)return e;if("string"!=typeof e)return null;if(e.length>i)return null;if(!(t?a[L]:a[b]).test(e))return null;try{return new Z(e,t)}catch(e){return null}}function Z(e,t){if(e instanceof Z){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof Z))return new Z(e,t);n("SemVer",e,t),this.loose=t;var r=e.trim().match(t?a[L]:a[b]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}t.parse=G,t.valid=function(e,t){var r=G(e,t);return r?r.version:null},t.clean=function(e,t){var r=G(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null},t.SemVer=Z,Z.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Z.prototype.toString=function(){return this.version},Z.prototype.compare=function(e){return n("SemVer.compare",this.version,this.loose,e),e instanceof Z||(e=new Z(e,this.loose)),this.compareMain(e)||this.comparePre(e)},Z.prototype.compareMain=function(e){return e instanceof Z||(e=new Z(e,this.loose)),J(this.major,e.major)||J(this.minor,e.minor)||J(this.patch,e.patch)},Z.prototype.comparePre=function(e){if(e instanceof Z||(e=new Z(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return J(r,i)}while(++t)},Z.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,r,n){"string"==typeof r&&(n=r,r=void 0);try{return new Z(e,r).inc(t,n).version}catch(e){return null}},t.diff=function(e,t){if(ee(e,t))return null;var r=G(e),n=G(t);if(r.prerelease.length||n.prerelease.length){for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return"pre"+i;return"prerelease"}for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return i},t.compareIdentifiers=J;var W=/^[0-9]+$/;function J(e,t){var r=W.test(e),n=W.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function K(e,t,r){return new Z(e,r).compare(new Z(t,r))}function Q(e,t,r){return K(e,t,r)>0}function Y(e,t,r){return K(e,t,r)<0}function ee(e,t,r){return 0===K(e,t,r)}function te(e,t,r){return 0!==K(e,t,r)}function re(e,t,r){return K(e,t,r)>=0}function ne(e,t,r){return K(e,t,r)<=0}function ie(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=ee(e,r,n);break;case"!=":i=te(e,r,n);break;case">":i=Q(e,r,n);break;case">=":i=re(e,r,n);break;case"<":i=Y(e,r,n);break;case"<=":i=ne(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function oe(e,t){if(e instanceof oe){if(e.loose===t)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.loose=t,this.parse(e),this.semver===ae?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return J(t,e)},t.major=function(e,t){return new Z(e,t).major},t.minor=function(e,t){return new Z(e,t).minor},t.patch=function(e,t){return new Z(e,t).patch},t.compare=K,t.compareLoose=function(e,t){return K(e,t,!0)},t.rcompare=function(e,t,r){return K(t,e,r)},t.sort=function(e,r){return e.sort(function(e,n){return t.compare(e,n,r)})},t.rsort=function(e,r){return e.sort(function(e,n){return t.rcompare(e,n,r)})},t.gt=Q,t.lt=Y,t.eq=ee,t.neq=te,t.gte=re,t.lte=ne,t.cmp=ie,t.Comparator=oe;var ae={};function se(e,t){if(e instanceof se)return e.loose===t?e:new se(e.raw,t);if(e instanceof oe)return new se(e.value,t);if(!(this instanceof se))return new se(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ue(e){return!e||"x"===e.toLowerCase()||"*"===e}function le(e,t,r,n,i,o,a,s,u,l,c,p,h){return((t=ue(r)?"":ue(n)?">="+r+".0.0":ue(i)?">="+r+"."+n+".0":">="+t)+" "+(s=ue(u)?"":ue(l)?"<"+(+u+1)+".0.0":ue(c)?"<"+u+"."+(+l+1)+".0":p?"<="+u+"."+l+"."+c+"-"+p:"<="+s)).trim()}function ce(e,t){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length){for(r=0;r<e.length;r++)if(n(e[r].semver),e[r].semver!==ae&&e[r].semver.prerelease.length>0){var i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}function pe(e,t,r){try{t=new se(t,r)}catch(e){return!1}return t.test(e)}function he(e,t,r,n){var i,o,a,s,u;switch(e=new Z(e,n),t=new se(t,n),r){case">":i=Q,o=ne,a=Y,s=">",u=">=";break;case"<":i=Y,o=re,a=Q,s="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(pe(e,t,n))return!1;for(var l=0;l<t.set.length;++l){var c=t.set[l],p=null,h=null;if(c.forEach(function(e){e.semver===ae&&(e=new oe(">=0.0.0")),p=p||e,h=h||e,i(e.semver,p.semver,n)?p=e:a(e.semver,h.semver,n)&&(h=e)}),p.operator===s||p.operator===u)return!1;if((!h.operator||h.operator===s)&&o(e,h.semver))return!1;if(h.operator===u&&a(e,h.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.loose?a[M]:a[I],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new Z(r[2],this.loose):this.semver=ae},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.loose),this.semver===ae||("string"==typeof e&&(e=new Z(e,this.loose)),ie(e,this.operator,this.semver,this.loose))},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Comparator is required");var r;if(""===this.operator)return r=new se(e.value,t),pe(this.value,r,t);if(""===e.operator)return r=new se(this.value,t),pe(e.semver,r,t);var n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),o=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=ie(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),u=ie(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||o&&a||s||u},t.Range=se,se.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},se.prototype.toString=function(){return this.range},se.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),n("range",e,t);var r=t?a[q]:a[B];e=e.replace(r,le),n("hyphen replace",e),e=e.replace(a[N],"$1$2$3"),n("comparator trim",e,a[N]),e=(e=(e=e.replace(a[z],"$1~")).replace(a[V],"$1^")).split(/\s+/).join(" ");var i=t?a[M]:a[I],o=e.split(" ").map(function(e){return function(e,t){return n("comp",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t);var r=t?a[F]:a[A];return e.replace(r,function(t,r,i,o,a){var s;return n("caret",e,t,r,i,o,a),ue(r)?s="":ue(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ue(o)?s="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":a?(n("replaceCaret pr",a),"-"!==a.charAt(0)&&(a="-"+a),s="0"===r?"0"===i?">="+r+"."+i+"."+o+a+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+a+" <"+(+r+1)+".0.0"):(n("no pr"),s="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",s),s})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){var r=t?a[R]:a[D];return e.replace(r,function(t,r,i,o,a){var s;return n("tilde",e,t,r,i,o,a),ue(r)?s="":ue(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ue(o)?s=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":a?(n("replaceTilde pr",a),"-"!==a.charAt(0)&&(a="-"+a),s=">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0"):s=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",s),s})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim();var r=t?a[S]:a[P];return e.replace(r,function(t,r,i,o,a,s){n("xRange",e,t,r,i,o,a,s);var u=ue(i),l=u||ue(o),c=l||ue(a),p=c;return"="===r&&p&&(r=""),u?t=">"===r||"<"===r?"<0.0.0":"*":r&&p?(l&&(o=0),c&&(a=0),">"===r?(r=">=",l?(i=+i+1,o=0,a=0):c&&(o=+o+1,a=0)):"<="===r&&(r="<",l?i=+i+1:o=+o+1),t=r+i+"."+o+"."+a):l?t=">="+i+".0.0 <"+(+i+1)+".0.0":c&&(t=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(a[U],"")}(e,t),n("stars",e),e}(e,t)}).join(" ").split(/\s+/);return this.loose&&(o=o.filter(function(e){return!!e.match(i)})),o=o.map(function(e){return new oe(e,t)})},se.prototype.intersects=function(e,t){if(!(e instanceof se))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(r){return e.set.some(function(e){return e.every(function(e){return r.intersects(e,t)})})})})},t.toComparators=function(e,t){return new se(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},se.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new Z(e,this.loose));for(var t=0;t<this.set.length;t++)if(ce(this.set[t],e))return!0;return!1},t.satisfies=pe,t.maxSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&-1!==i.compare(e)||(i=new Z(n=e,r)))}),n},t.minSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&1!==i.compare(e)||(i=new Z(n=e,r)))}),n},t.validRange=function(e,t){try{return new se(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,r){return he(e,t,"<",r)},t.gtr=function(e,t,r){return he(e,t,">",r)},t.outside=he,t.prerelease=function(e,t){var r=G(e,t);return r&&r.prerelease.length?r.prerelease:null},t.intersects=function(e,t,r){return e=new se(e,r),t=new se(t,r),e.intersects(t)},t.coerce=function(e){if(e instanceof Z)return e;if("string"!=typeof e)return null;var t=e.match(a[C]);return null==t?null:G((t[1]||"0")+"."+(t[2]||"0")+"."+(t[3]||"0"))}}).call(this,r(1))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,l=[],c=!1,p=-1;function h(){c&&u&&(c=!1,u.length?l=u.concat(l):p=-1,l.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=l.length;t;){for(u=l,l=[];++p<t;)u&&u[p].run();p=-1,t=l.length}u=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||c||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n);function o(e){return"string"==typeof e?document.querySelector(e):e}function a(e){return"string"==typeof e?e:e.propertyName}function s(e){return"string"==typeof e?null:e}var u=function(e){return e=e||Object.create(null),{on:function(t,r){(e[t]||(e[t]=[])).push(r)},off:function(t,r){e[t]&&e[t].splice(e[t].indexOf(r)>>>0,1)},emit:function(t,r){(e[t]||[]).slice().map(function(e){e(r)}),(e["*"]||[]).slice().map(function(e){e(t,r)})}}},l=function(){function e(t,r,n,i,o){void 0===o&&(o=!0),this._emitter=new u,this._name="asbind_"+t+"_"+r+"_"+e._counter,this._column=r,this._layer=n,this._source=i,this._readOnly=o,e._counter++,this._loadLegendData=this._loadLegendData.bind(this)}return Object.defineProperty(e.prototype,"globalExpression",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"column",{get:function(){return this._column},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readOnly",{get:function(){return this._readOnly},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t){this._emitter.on(e,t)},e.prototype.setLegendData=function(e){this._legendData=e.data},e.prototype.enableColorMapping=function(){this._mapColors=!0,this._layer.viz?this._loadLegendData():this._layer.on("loaded",this._loadLegendData)},e.prototype._filterChanged=function(){this._emitter.emit("filterChanged",this._name)},e.prototype._loadLegendData=function(){var e=this._layer.viz.color;e.getLegendData&&this.setLegendData(e.getLegendData(this._getLegendConfig()))},e.prototype._getLegendConfig=function(){},e._counter=0,e}();function c(e,t){return h(e.value,t.value,f)}function p(e,t){return h(e.value,t.value,m)}function h(e,t,r){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(r(e[n],t[n]))return!1;return!0}function f(e,t){return e.x[0]!==t.x[0]||e.x[1]!==t.x[1]||e.y!==t.y}function m(e,t){return e.x!==t.x||e.y!==t.y}function v(e){return"string"==typeof e?e:function(e){return"#"+_(e.r)+_(e.g)+_(e.b)+_(255*e.a)}(e)}function _(e){return isNaN(e)||void 0===e?"":e.toString(16).padStart(2,"0").toUpperCase()}function d(e){return e.value.map(function(e){return{end:e.x[1],start:e.x[0],value:e.y}})}function g(e,t){return e.value.map(function(e){return{category:e.x,color:y(e.x,t),end:void 0,start:void 0,value:e.y}})}function y(e,t){if(t){var r=t.find(function(t){return t.key===e});return r?v(r.value):void 0}}var b,w=function(e,t){return e.value.map(function(e){return{color:y(e.x,t),name:e.x,value:e.y}})},x=(b=function(e,t){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),L=function(e){function t(t,r,n,i,a,s,u,l){void 0===s&&(s=!0);var c=e.call(this,"category",i,r,a,s)||this;return c._selection=[],c._lastHistogram=null,c._button=null,c._widget=o(n),c._carto=t,c._button=o(u),c._expression=l,c._widget.disableInteractivity=s,c._widget.showClearButton=!s,c.selectionChanged=c.selectionChanged.bind(c),s||(c._widget.addEventListener("categoriesSelected",c.selectionChanged),c._button&&c._button.addEventListener&&c._button.addEventListener("click",function(){c._filterChanged()})),c}return x(t,e),t.prototype.setDataLayer=function(e){var t=this;this._dataLayer=e,this._dataLayer.on("updated",function(){var e=t._dataLayer.viz.variables[t.name];e&&(null!==t._lastHistogram&&p(t._lastHistogram,e)||(t._lastHistogram={value:e.value},t._widget.categories=w(e,t._legendData)))})},Object.defineProperty(t.prototype,"filter",{get:function(){return 0===this._selection.length?null:"$"+this._column+" in ["+this._selection.map(function(e){return"'"+e+"'"}).join(",")+"]"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{get:function(){var e=this._carto.expressions;return e.viewportHistogram(this._expression?this._expression:e.prop(this._column))},enumerable:!0,configurable:!0}),t.prototype.selectionChanged=function(e){this._selection=e.detail,0!==this._selection.length&&this._button||this._filterChanged()},t}(l),j=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),O=function(e){function t(t,r,n,i,a,s,u,l,c){void 0===u&&(u=!0),void 0===l&&(l=!1),void 0===c&&(c=null);var p=e.call(this,"histogram_"+t,a,n,s,u)||this;return p._selection=null,p._inputExpression=null,p._totals=!1,p._widget=o(i),p._carto=r,p._totals=l,p._widget.disableInteractivity=u,p._widget.showClear=!u,p._inputExpression=c,p.selectionChanged=p.selectionChanged.bind(p),u||p._widget.addEventListener("selectionChanged",p.selectionChanged),p}return j(t,e),t.prototype.removeHistogramLayer=function(){this._layer.remove()},t.prototype.setDataLayer=function(e){this._dataLayer=e,this.bindDataLayer()},t.prototype._getLegendConfig=function(){return{samples:this._buckets}},t}(l),E=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),T=function(e){function t(t,r,n,i,o,a,s,u){void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===u&&(u=null);var l=e.call(this,"categorical",t,r,n,i,o,a,s,u)||this;return l._lastHistogram=null,l}return E(t,e),Object.defineProperty(t.prototype,"filter",{get:function(){return null===this._selection?null:"$"+this._column+" in ["+this._selection.map(function(e){return"'"+e+"'"}).join(",")+"]"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{get:function(){var e=this._carto.expressions;return e.viewportHistogram(this._inputExpression?this._inputExpression:e.prop(this._column))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalExpression",{get:function(){if(!this._totals)return null;var e=this._carto.expressions;return e.sampleHistogram(this._inputExpression?this._inputExpression:e.prop(this._column))},enumerable:!0,configurable:!0}),t.prototype.bindDataLayer=function(){var e=this;this._dataLayer.on("updated",function(){e._totals&&!e._sampleHistogram&&(e._sampleHistogram=e._dataLayer.viz.variables[e.name+"_global"],e._widget.backgroundData=g(e._sampleHistogram));var t=e._dataLayer.viz.variables[e.name];if(t&&(null===e._lastHistogram||!p(e._lastHistogram,t)))if(e._lastHistogram={value:t.value},e._sampleHistogram){var r=e._sampleHistogram.value.map(function(e){var r=t.value.find(function(t){return t.x===e.x});return{x:e.x,y:r?r.y:0}});e._widget.data=g({value:r},e._legendData)}else e._widget.data=g(t,e._legendData)})},t.prototype.selectionChanged=function(e){if(null===e.detail)this._selection=null;else{var t=e.detail.selection;this._selection=t.map(function(e){return e})}this._filterChanged()},t}(O),k=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),P=function(e){function t(t,r,n,i,o,a,s,u,l,c){void 0===o&&(o=20),void 0===u&&(u=!0),void 0===l&&(l=!1),void 0===c&&(c=null);var p=e.call(this,"numerical",t,r,n,i,a,u,l,c)||this;return p._lastHistogram=null,p._buckets=void 0!==s?s.length:o,p._bucketRanges=s,p}return k(t,e),Object.defineProperty(t.prototype,"filter",{get:function(){return null===this._selection||this._isTimeSeries?null:"($"+this._column+" >= "+this._selection[0]+" and $"+this._column+" < "+this._selection[1]+")"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{get:function(){if(this._totals&&!this._sampleHistogram)return null;var e=this._carto.expressions;return e.viewportHistogram(this._inputExpression?this._inputExpression:e.prop(this._column),this._bucketArg())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalExpression",{get:function(){if(!this._totals)return null;var e=this._carto.expressions;return e.sampleHistogram(this._inputExpression?this._inputExpression:e.prop(this._column),this._bucketArg())},enumerable:!0,configurable:!0}),t.prototype.setTimeSeries=function(e){this._isTimeSeries=e},t.prototype.enableColorMapping=function(){throw new Error("Unsupported for numerical histograms")},t.prototype.setLegendData=function(){throw new Error("Unsupported for numerical histograms")},t.prototype.bindDataLayer=function(){var e=this;this._dataLayer.on("updated",function(){e._totals&&!e._sampleHistogram&&(e._sampleHistogram=e._dataLayer.viz.variables[e.name+"_global"],e._sampleHistogram&&(e._bucketRanges=e._sampleHistogram.value.map(function(e){return[e.x[0],e.x[1]]}),e._emitter.emit("expressionReady",{name:e.name,expression:e.expression})),e._widget.backgroundData=d(e._sampleHistogram));var t=e._dataLayer.viz.variables[e.name];t&&(null===t.value||null!==e._lastHistogram&&c(e._lastHistogram,t)||(e._emitter.emit("rangeChanged",[t.value[0].x[0],t.value[t.value.length-1].x[1]]),e._lastHistogram={value:t.value},e._widget.data=d(t)))})},t.prototype.selectionChanged=function(e){if(null===e.detail)this._selection=null;else{var t=this._isTimeSeries?e.detail:e.detail.selection;this._selection=[Number(t[0]),Number(t[1])]}this._emitter.emit("rangeChanged",this._selection),this._filterChanged()},t.prototype._bucketArg=function(){return void 0!==this._bucketRanges?this._bucketRanges:this._buckets},t}(O),S=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),C=function(e){function t(t,r,n,i,a){var s=e.call(this,"category",i,r,a,!1)||this;return s._value=null,s._widget=o(n),s._carto=t,s._widget.addEventListener("change",function(e){s._value=e.detail,s._filterChanged()}),s}return S(t,e),t.prototype.setDataLayer=function(e){var t=this;this._dataLayer=e,this._dataLayer.on("updated",function(){var e=t._dataLayer.viz.variables[t.name];e&&!t._populated&&(t._widget.minValue=e.value[0],t._widget.maxValue=e.value[1],t._widget.range=e.value,t._populated=!0)})},Object.defineProperty(t.prototype,"filter",{get:function(){return null===this._value?null:"$"+this.column+" > "+this._value[0]+" and $"+this.column+" < "+this._value[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{get:function(){var e=this._carto.expressions;return e.list([e.globalMin(e.prop(this._column)),e.globalMax(e.prop(this._column))])},enumerable:!0,configurable:!0}),t}(l),H=function(){function e(e,t,r){var n=this;this._timeSeries=o(t),this._layer=e,e.viz?(this._onLayerLoaded(),r()):e.on("loaded",function(){n._onLayerLoaded(),r()})}return e.prototype.removeHistogramLayer=function(){this._dataLayer.remove()},e.prototype.setRange=function(e){this._animation&&this._animation.input&&this._animation.input.min&&this._animation.input.max&&(null===e?(this._animation.input.min.blendTo(this._min,0),this._animation.input.max.blendTo(this._max,0)):(this._animation.input.min.blendTo(e[0],0),this._animation.input.max.blendTo(e[1],0)))},e.prototype._onLayerLoaded=function(){var e=this;if(this._viz=this._layer.viz,!this._viz.variables.animation)throw new Error("Variable @animation missing!");this._animation=this._viz.variables.animation,this._max=this._viz.variables.animation.input.max,this._min=this._viz.variables.animation.input.min,this._layer.on("updated",function(){e._timeSeries.progress=100*e._animation.getProgressPct(),e._timeSeries.playing=e._animation.isPlaying()}),this._timeSeries.animated=!0,this._timeSeries.addEventListener("seek",function(t){e._animation.setProgressPct(t.detail/100),e._timeSeries.progress=t.detail}),this._timeSeries.addEventListener("play",function(){e._animation.play()}),this._timeSeries.addEventListener("pause",function(){e._animation.pause()})},e}(),z="^1.1.0",D=function(){function e(e){var t=e.carto,r=e.map,n=e.layer,o=e.source;if(this._vizFilters=[],this._carto=t,this._map=r,this._layer=n,this._source=o,this._id=this._layer.id,this._rebuildFilters=this._rebuildFilters.bind(this),this._updateDataLayerVariables=this._updateDataLayerVariables.bind(this),!this._carto.expressions.sampleHistogram)throw new Error("Provided VL version "+this._carto.version+" lacks sampleHistogram support.");if(!i.a.satisfies(this._carto.version,z))throw new Error("Provided VL version "+this._carto.version+" not supported. Must satisfy "+z)}return e.prototype.numericalHistogram=function(e,t,r){void 0===r&&(r={});var n=r.buckets,i=r.bucketRanges,o=r.readOnly,u=r.totals,l=a(t),c=s(t),p=new P(this._carto,this._layer,e,l,n,this._source,i,o,u,c);return this._addFilter(p),p},e.prototype.categoricalHistogram=function(e,t,r){void 0===r&&(r={});var n=r.readOnly,i=r.totals,o=a(t),u=s(t),l=new T(this._carto,this._layer,e,o,this._source,n,i,u);return this._addFilter(l),l},e.prototype.histogram=function(e,t,r){void 0===r&&(r={});var n=r.buckets,i=r.bucketRanges,o=r.readOnly,a=r.totals;if(void 0===n&&void 0===i){var s=e;return this.categoricalHistogram(s,t,{readOnly:o,totals:a})}return this.numericalHistogram(e,t,{readOnly:o,buckets:n,bucketRanges:i,totals:a})},e.prototype.category=function(e,t,r){void 0===r&&(r={});var n=r.readOnly,i=r.button,o=a(t),u=s(t),l=new L(this._carto,this._layer,e,o,this._source,n,i,u);return this._addFilter(l),l},e.prototype.timeSeries=function(e,t,r){var n=this;if(void 0===r&&(r={}),this._animation)throw new Error("There can only be one animation");var i=r.buckets,o=r.readOnly,a=r.totals;this._animation=new H(this._layer,e,function(){n._rebuildFilters()});var s=this.numericalHistogram(e,t,{buckets:i,readOnly:o,totals:a});s.setTimeSeries(!0),s.on("rangeChanged",function(e){n._animation.setRange(e)})},e.prototype.globalRange=function(e,t){var r=new C(this._carto,this._layer,e,t,this._source);return this._addFilter(r),r},e.prototype.build=function(){var e=this;if(0!==this._vizFilters.length){var t=function(){e._appendVariables(),e._buildDataLayer()};this._layer.viz?t():this._layer.on("loaded",t)}},e.prototype._addFilter=function(e){e.on("filterChanged",this._rebuildFilters),e.on("expressionReady",this._updateDataLayerVariables),this._vizFilters.push(e)},e.prototype._appendVariables=function(){var e=this,t=this._carto.expressions;this._vizFilters.forEach(function(r){return e._layer.viz.variables[r.name+"_col"]=t.prop(r.column)})},e.prototype._buildDataLayer=function(){var e=this,t=this._getVariables(),r=this._carto.expressions,n=new this._carto.Viz({color:r.rgba(0,0,0,0),strokeWidth:0,variables:t});this._readOnlyLayer=new this._carto.Layer("asbind_ro_"+this._id,this._source,n),this._readOnlyLayer.addTo(this._map),this._vizFilters.forEach(function(t){return t.setDataLayer(e._readOnlyLayer)})},e.prototype._getVariables=function(){for(var e=void 0!==this._readOnlyLayer?this._readOnlyLayer.viz.variables:{},t=0,r=this._vizFilters;t<r.length;t++){var n=r[t],i=n.name;n.globalExpression&&(e[i+"_global"]=n.globalExpression),n.expression&&(e[i]=n.expression)}return e},e.prototype._updateDataLayerVariables=function(e){this._readOnlyLayer.viz&&(this._readOnlyLayer.viz.variables[e.name]=e.expression)},e.prototype._rebuildFilters=function(){var e=this._combineFilters(this._vizFilters.filter(function(e){return null!==e.filter}).map(function(e){return e.filter}));this._readOnlyLayer&&this._readOnlyLayer.viz.filter.blendTo(e,0),this._animation&&(e="@animation and "+e),this._layer.viz.filter.blendTo(e,0)},e.prototype._combineFilters=function(e){return 0===e.length?"1":e.join(" and ")},e}();r.d(t,"VLBridge",function(){return D})}])});